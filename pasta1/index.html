<!-- Botão Voltar -->
<script>
  // Função para voltar à página inicial
  function voltarInicio() {
    window.location.href = "../index.html"; // volta um nível para cima
  }
</script>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Licenças AGV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .hero-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #581c87 100%);
            min-height: 100vh;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-ativa { background-color: #10b981; }
        .status-vencida { background-color: #ef4444; }
        .status-renovada { background-color: #f59e0b; }
        .status-cancelada { background-color: #6b7280; }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #1f2937;
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #374151;
        }
    </style>
</head>
<body class="hero-bg">
    <!-- Header -->
    <header class="bg-black/20 backdrop-blur-md border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <button onclick="voltarMenu()" class="bg-white/20 p-2 rounded-lg backdrop-blur-sm hover:bg-white/30 transition-colors">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </button>
                    <div class="bg-white/20 p-3 rounded-xl backdrop-blur-sm">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Controle de Licenças AGV</h1>
                        <p class="text-white/80 text-sm">Gestão de Licenças dos Agentes Virtuais</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="abrirModalCadastro()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Nova Licença</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-black/30 backdrop-blur-md rounded-xl p-6 border border-white/20 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Total de Licenças</p>
                        <p class="text-3xl font-bold text-white" id="totalLicencas">0</p>
                    </div>
                    <div class="bg-blue-500/20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-black/30 backdrop-blur-md rounded-xl p-6 border border-white/20 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Total de Canais</p>
                        <p class="text-3xl font-bold text-green-400" id="totalCanais">0</p>
                    </div>
                    <div class="bg-green-500/20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-black/30 backdrop-blur-md rounded-xl p-6 border border-white/20 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Total de Campanhas</p>
                        <p class="text-3xl font-bold text-purple-400" id="totalCampanhas">0</p>
                    </div>
                    <div class="bg-purple-500/20 p-3 rounded-lg">
                        <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="bg-black/30 backdrop-blur-md rounded-xl p-6 border border-white/20 mb-8">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <input type="text" id="searchInput" placeholder="Buscar por plataforma, carteira, campanha ou código..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-2">
                    <select id="plataformaFilter" class="px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Plataforma</option>
                        <option value="Aspect">Aspect</option>
                        <option value="Paneas">Paneas</option>
                        <option value="Pontal">Pontal</option>
                        <option value="Robbu">Robbu</option>
                        <option value="Sinergytech">Sinergytech</option>
                        <option value="TechIA">TechIA</option>
                    </select>
                    <button onclick="filtrarLicencas()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        Filtrar
                    </button>
                </div>
            </div>
        </div>

        <!-- Licenses Table -->
        <div class="bg-black/30 backdrop-blur-md rounded-xl border border-white/20 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-black/50">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Plataforma</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Carteira</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Campanha</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Tipo</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Canais</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">AV</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Ambiente</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-white/80">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="licencasTableBody" class="divide-y divide-gray-700">
                        <!-- Licenças serão inseridas aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Modal de Cadastro -->
    <div id="modalCadastro" class="modal">
        <div class="modal-content fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Nova Licença</h2>
                <button onclick="fecharModalCadastro()" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="formCadastro" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="plataforma" class="block text-sm font-medium text-gray-300 mb-2">Plataforma</label>
                        <select id="plataforma" name="plataforma" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Selecione a plataforma</option>
                            <option value="Aspect">Aspect</option>
                            <option value="Paneas">Paneas</option>
                            <option value="Pontal">Pontal</option>
                            <option value="Robbu">Robbu</option>
                            <option value="Sinergytech">Sinergytech</option>
                            <option value="TechIA">TechIA</option>
                        </select>
                    </div>
                    <div>
                        <label for="codigo" class="block text-sm font-medium text-gray-300 mb-2">Código</label>
                        <input type="text" id="codigo" name="codigo" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Código (opcional)">
                    </div>
                    <div>
                        <label for="carteira" class="block text-sm font-medium text-gray-300 mb-2">Carteira</label>
                        <input type="text" id="carteira" name="carteira" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nome da carteira">
                    </div>
                    <div>
                        <label for="campanha" class="block text-sm font-medium text-gray-300 mb-2">Campanha</label>
                        <input type="text" id="campanha" name="campanha" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nome da campanha">
                    </div>
                    <div>
                        <label for="tipo" class="block text-sm font-medium text-gray-300 mb-2">Tipo</label>
                        <input type="text" id="tipo" name="tipo" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Tipo">
                    </div>
                    <div>
                        <label for="canais" class="block text-sm font-medium text-gray-300 mb-2">Canais</label>
                        <input type="number" id="canais" name="canais" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Número de canais">
                    </div>
                    <div>
                        <label for="av" class="block text-sm font-medium text-gray-300 mb-2">AV</label>
                        <input type="number" id="av" name="av" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Número de AV">
                    </div>
                    <div>
                        <label for="transbordo" class="block text-sm font-medium text-gray-300 mb-2">Transbordo</label>
                        <input type="text" id="transbordo" name="transbordo" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Transbordo (opcional)">
                    </div>
                    <div>
                        <label for="dnis" class="block text-sm font-medium text-gray-300 mb-2">DNIS</label>
                        <input type="text" id="dnis" name="dnis" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="DNIS (opcional)">
                    </div>
                    <div>
                        <label for="tech" class="block text-sm font-medium text-gray-300 mb-2">Tech</label>
                        <input type="text" id="tech" name="tech" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Tech (opcional)">
                    </div>
                    <div>
                        <label for="kmg" class="block text-sm font-medium text-gray-300 mb-2">KMG</label>
                        <input type="text" id="kmg" name="kmg" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="KMG (opcional)">
                    </div>
                    <div>
                        <label for="ambiente" class="block text-sm font-medium text-gray-300 mb-2">Ambiente</label>
                        <input type="text" id="ambiente" name="ambiente" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ambiente">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="fecharModalCadastro()" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                        Salvar Licença
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Array para armazenar as licenças
        let licencas = [
            {
                id: 1,
                plataforma: "Aspect",
                codigo: "ASP001",
                carteira: "Vendas Corporativas",
                campanha: "Black Friday 2024",
                tipo: "Receptivo",
                canais: 10,
                av: 5,
                transbordo: "Sim",
                dnis: "4000-1234",
                tech: "João Silva",
                kmg: "KMG001",
                ambiente: "Produção"
            },
            {
                id: 2,
                plataforma: "Robbu",
                codigo: "",
                carteira: "Atendimento Geral",
                campanha: "Suporte Técnico",
                tipo: "Ativo",
                canais: 15,
                av: 8,
                transbordo: "",
                dnis: "",
                tech: "",
                kmg: "",
                ambiente: "Homologação"
            }
        ];

        // Função para voltar ao menu principal
        function voltarMenu() {
            window.location.href = '../index.html';
        }

        // Função para abrir modal de cadastro
        function abrirModalCadastro() {
            document.getElementById('modalCadastro').classList.add('show');
        }

        // Função para fechar modal de cadastro
        function fecharModalCadastro() {
            document.getElementById('modalCadastro').classList.remove('show');
            document.getElementById('formCadastro').reset();
        }

        // Função para formatar data
        function formatarData(data) {
            if (!data) return '-';
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        // Função para obter classe do status
        function obterClasseStatus(status) {
            const classes = {
                'ativa': 'status-ativa',
                'vencida': 'status-vencida',
                'renovada': 'status-renovada',
                'cancelada': 'status-cancelada'
            };
            return classes[status] || 'bg-gray-500';
        }

        // Função para renderizar tabela
        function renderizarTabela(licencasFiltradas = licencas) {
            const tbody = document.getElementById('licencasTableBody');
            
            if (licencasFiltradas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                            <div class="flex flex-col items-center">
                                <svg class="w-12 h-12 mb-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <p class="text-lg font-medium">Nenhuma licença encontrada</p>
                                <p class="text-sm">Cadastre uma nova licença para começar</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = licencasFiltradas.map(licenca => `
                <tr class="hover:bg-white/5 transition-colors">
                    <td class="px-6 py-4 text-white">${licenca.plataforma || '-'}</td>
                    <td class="px-6 py-4 text-white">${licenca.carteira || '-'}</td>
                    <td class="px-6 py-4 text-white">${licenca.campanha || '-'}</td>
                    <td class="px-6 py-4 text-white">${licenca.tipo || '-'}</td>
                    <td class="px-6 py-4 text-white">${licenca.canais || '-'}</td>
                    <td class="px-6 py-4 text-white">${licenca.av || '-'}</td>
                    <td class="px-6 py-4 text-white">${licenca.ambiente || '-'}</td>
                    <td class="px-6 py-4">
                        <div class="flex space-x-2">
                            <button onclick="editarLicenca(${licenca.id})" class="text-blue-400 hover:text-blue-300 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="excluirLicenca(${licenca.id})" class="text-red-400 hover:text-red-300 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Função para atualizar estatísticas
        function atualizarEstatisticas() {
            const totalLicencas = licencas.length;
            const totalCanais = licencas.reduce((sum, licenca) => sum + (parseInt(licenca.canais) || 0), 0);
            const totalCampanhas = [...new Set(licencas.map(l => l.campanha).filter(c => c))].length;

            document.getElementById('totalLicencas').textContent = totalLicencas;
            document.getElementById('totalCanais').textContent = totalCanais;
            document.getElementById('totalCampanhas').textContent = totalCampanhas;
        }

        // Função para filtrar licenças
        function filtrarLicencas() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const plataformaFilter = document.getElementById('plataformaFilter').value;

            const licencasFiltradas = licencas.filter(licenca => {
                const matchSearch = !searchTerm || 
                    (licenca.plataforma && licenca.plataforma.toLowerCase().includes(searchTerm)) ||
                    (licenca.carteira && licenca.carteira.toLowerCase().includes(searchTerm)) ||
                    (licenca.campanha && licenca.campanha.toLowerCase().includes(searchTerm)) ||
                    (licenca.codigo && licenca.codigo.toLowerCase().includes(searchTerm));
                
                const matchPlataforma = !plataformaFilter || licenca.plataforma === plataformaFilter;
                
                return matchSearch && matchPlataforma;
            });

            renderizarTabela(licencasFiltradas);
        }

        // Event listeners para filtros em tempo real
        document.getElementById('searchInput').addEventListener('input', filtrarLicencas);
        document.getElementById('plataformaFilter').addEventListener('change', filtrarLicencas);

        // Função para cadastrar nova licença
        document.getElementById('formCadastro').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const novaLicenca = {
                id: Date.now(),
                plataforma: formData.get('plataforma') || '',
                codigo: formData.get('codigo') || '',
                carteira: formData.get('carteira') || '',
                campanha: formData.get('campanha') || '',
                tipo: formData.get('tipo') || '',
                canais: parseInt(formData.get('canais')) || 0,
                av: parseInt(formData.get('av')) || 0,
                transbordo: formData.get('transbordo') || '',
                dnis: formData.get('dnis') || '',
                tech: formData.get('tech') || '',
                kmg: formData.get('kmg') || '',
                ambiente: formData.get('ambiente') || ''
            };

            licencas.push(novaLicenca);
            renderizarTabela();
            atualizarEstatisticas();
            fecharModalCadastro();
            
            // Mostrar mensagem de sucesso
            alert('Licença cadastrada com sucesso!');
        });

        // Função para editar licença
        function editarLicenca(id) {
            const licenca = licencas.find(l => l.id === id);
            if (licenca) {
                // Preencher formulário com dados da licença
                document.getElementById('plataforma').value = licenca.plataforma || '';
                document.getElementById('codigo').value = licenca.codigo || '';
                document.getElementById('carteira').value = licenca.carteira || '';
                document.getElementById('campanha').value = licenca.campanha || '';
                document.getElementById('tipo').value = licenca.tipo || '';
                document.getElementById('canais').value = licenca.canais || '';
                document.getElementById('av').value = licenca.av || '';
                document.getElementById('transbordo').value = licenca.transbordo || '';
                document.getElementById('dnis').value = licenca.dnis || '';
                document.getElementById('tech').value = licenca.tech || '';
                document.getElementById('kmg').value = licenca.kmg || '';
                document.getElementById('ambiente').value = licenca.ambiente || '';
                
                // Alterar comportamento do formulário para edição
                const form = document.getElementById('formCadastro');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    
                    // Atualizar licença existente
                    const index = licencas.findIndex(l => l.id === id);
                    licencas[index] = {
                        ...licencas[index],
                        plataforma: formData.get('plataforma') || '',
                        codigo: formData.get('codigo') || '',
                        carteira: formData.get('carteira') || '',
                        campanha: formData.get('campanha') || '',
                        tipo: formData.get('tipo') || '',
                        canais: parseInt(formData.get('canais')) || 0,
                        av: parseInt(formData.get('av')) || 0,
                        transbordo: formData.get('transbordo') || '',
                        dnis: formData.get('dnis') || '',
                        tech: formData.get('tech') || '',
                        kmg: formData.get('kmg') || '',
                        ambiente: formData.get('ambiente') || ''
                    };
                    
                    renderizarTabela();
                    atualizarEstatisticas();
                    fecharModalCadastro();
                    alert('Licença atualizada com sucesso!');
                    
                    // Restaurar comportamento original do formulário
                    form.onsubmit = null;
                };
                
                abrirModalCadastro();
            }
        }

        // Função para excluir licença
        function excluirLicenca(id) {
            if (confirm('Tem certeza que deseja excluir esta licença?')) {
                licencas = licencas.filter(l => l.id !== id);
                renderizarTabela();
                atualizarEstatisticas();
                alert('Licença excluída com sucesso!');
            }
        }

        // Fechar modal ao clicar fora
        document.getElementById('modalCadastro').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalCadastro();
            }
        });

        // Inicializar página
        document.addEventListener('DOMContentLoaded', function() {
            renderizarTabela();
            atualizarEstatisticas();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987c3a4b4126f1dd',t:'MTc1OTMyNDUxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

